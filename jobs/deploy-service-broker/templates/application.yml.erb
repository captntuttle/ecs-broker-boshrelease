<% repo_svc = properties.catalog_services.find{|s| s.repository_service == true} -%>
<% repo_plan = repo_svc.plans.find{|p| p.repository_plan == true} -%>
broker:
  management-endpoint: "<%= properties.management_endpoint %>"
  replication-group: <%= properties.replication_group %>
  namespace: <%= properties.namespace %>
<% unless properties.api_username.to_s.empty? -%>
  username: <%= properties.api_username %>
<% end -%>
<% unless properties.api_password.to_s.empty? -%>
  password: <%= properties.api_password%>
<% end -%>
<% unless properties.api_version.to_s.empty? -%>
  broker-api-version: "<%= properties.api_version %>"
<% end -%>
<% unless properties.object_endpoint.to_s.empty? -%>
  object-endpoint: <%= properties.object_endpoint %>
<% end -%>
<% unless properties.repository_endpoint.to_s.empty? -%>
  repository-endpoint: <%= properties.repository_endpoint%>
<% end -%>
<% unless properties.certificate.to_s.empty? -%>
  certificate: ecs_cert.pem
<% end -%>
<% unless properties.base_url.to_s.empty? -%>
  base-url: <%= properties.base_url %>
<% end -%>
<% unless properties.repository_user.to_s.empty? -%>
  repository-user: <%= properties.repository_user%>
<% end -%>
<% unless properties.repository_bucket.to_s.empty? -%>
  repository-bucket: <%= properties.repository_bucket %>
<% end -%>
<% unless properties.prefix.to_s.empty? -%>
  prefix: <%= properties.prefix %>
<% end -%>
  repository-service-id: <%= repo_svc.id %>
  repository-plan-id: <%= repo_plan.id %>
security:
  <%= properties.security_username %>:
    password: <%= properties.security_password %>
catalog:
  services:
<% properties.catalog_services.each do |s| -%>
  - id: <%= s.id %>
    name: <%= s.name %>
    description: <%= s.description %>
    plan-updatable: true
<% unless s.bindable.to_s.empty? -%>
    bindable: <%= s.bindable %>
<% end -%>
<% unless s.tags.nil? -%>
    tags:
<% s.tags.each do |t| -%>
    - <%= t %>
<% end -%>
<% end -%>
<% unless s.settings.nil? -%>
<% if s.settings.file_accessible == true -%>
    requires:
    - volume_mount
<% end -%>
    service-settings:
<% unless s.settings.service_type.to_s.empty? -%>
      service-type: <%= s.settings.service_type %>
<% end -%>
<% unless s.settings.encrypted.to_s.empty? -%>
      encrypted: <%= s.settings.encrypted %>
<% end -%>
<% unless s.settings.access_during_outage.to_s.empty? -%>
      access-during-outage: <%= s.settings.access_during_outage %>
<% end -%>
<% unless s.settings.file_accessible.to_s.empty? -%>
      file-accessible: <%= s.settings.file_accessible %>
<% end -%>
<% unless s.settings.head_type.to_s.empty? -%>
      head-type: <%= s.settings.head_type %>
<% end -%>
<% unless s.settings.default_retention.to_s.empty? -%>
      default-retention: <%= s.settings.default_retention %>
<% end -%>
<% unless s.settings.quota.nil? -%>
      quota:
        limit: <%= s.settings.quota.limit %>
        warn: <%= s.settings.quota.warn %>
<% end -%>
<% unless s.settings.domain_group_admins.nil? -%>
      domain-group-admins:
<% s.settings.domain_group_admins do |a| %>
      - <%= a %>
<% end -%>
<% end -%>
<% unless s.settings.compliance_enabled.to_s.empty? -%>
      compliance-enabled: <%= s.settings.compliance_enabled %>
<% end -%>
<% unless s.settings.default_bucket_quota.to_s.empty? -%>
      default-bucket-quota: <%= s.settings.default_bucket_quota %>
<% end -%>
<% unless s.settings.default_bucket_quota.to_s.empty? -%>
      default-bucket-quota: <%= s.settings.default_bucket_quota %>
<% end -%>
<% end -%>
<% unless s.metadata.nil? -%>
    metadata:
<% unless s.metadata.display_name.to_s.empty? -%>
      displayName: <%= s.metadata.displayName %>
<% end -%>
<% unless s.metadata.image_url.to_s.empty? -%>
      imageUrl: <%= s.metadata.image_url %>
<% end -%>
<% unless s.metadata.long_description.to_s.empty? -%>
      longDescription: <%= s.metadata.long_description %>
<% end -%>
<% unless s.metadata.provider_display_name.to_s.empty? -%>
      providerDisplayName: <%= s.metadata.provider_display_name %>
<% end -%>
<% unless s.metadata.documentation_url.to_s.empty? -%>
      documentationUrl: <%= s.metadata.documentation_url %>
<% end -%>
<% unless s.metadata.support_url.to_s.empty? -%>
      supportUrl: <%= s.metadata.support_url %>
<% end -%>
<% end -%>
<% unless s.plans.nil? -%>
    plans:
<% s.plans.each do |p| -%>
    - id: <%= p.id %>
      name: <%= p.name %>
      description: <%= p.description %>
<% unless p.free.to_s.empty? -%>
      free: <%= p.free %>
<% end -%>
<% unless p.settings.nil? -%>
      service-settings:
<% unless p.settings.service_type.to_s.empty? -%>
        service-type: <%= p.settings.service_type %>
<% end -%>
<% unless p.settings.encrypted.to_s.empty? -%>
        encrypted: <%= p.settings.encrypted %>
<% end -%>
<% unless p.settings.access_during_outage.to_s.empty? -%>
        access-during-outage: <%= p.settings.access_during_outage %>
<% end -%>
<% unless p.settings.file_accessible.to_s.empty? -%>
        file-accessible: <%= p.settings.file_accessible %>
<% end -%>
<% unless p.settings.head_type.to_s.empty? -%>
        head-type: <%= p.settings.head_type %>
<% end -%>
<% unless p.settings.default_retention.to_s.empty? -%>
        default-retention: <%= p.settings.default_retention %>
<% end -%>
<% unless p.settings.quota.nil? -%>
        quota:
          limit: <%= p.settings.quota.limit %>
          warn: <%= p.settings.quota.warn %>
<% end -%>
<% unless p.settings.domain_group_admins.nil? -%>
        domain-group-admins:
<% p.settings.domain_group_admins do |a| %>
        - <%= a %>
<% end -%>
<% end -%>
<% unless p.settings.compliance_enabled.to_s.empty? -%>
        compliance-enabled: <%= p.settings.compliance_enabled %>
<% end -%>
<% unless p.settings.default_bucket_quota.to_s.empty? -%>
        default-bucket-quota: <%= p.settings.default_bucket_quota %>
<% end -%>
<% unless p.settings.default_bucket_quota.to_s.empty? -%>
        default-bucket-quota: <%= p.settings.default_bucket_quota %>
<% end -%>
<% end -%>
<% unless p.metadata.nil? -%>
      metadata:
<% unless p.metadata.costs.nil? -%>
        costs:
<% p.metadata.costs.each do |c| -%>
        - amount:
            usd: <%= c.usd %>
            unit: <%= c.unit %>
<% end -%>
<% end -%>
<% unless p.metadata.bullets.nil? -%>
        bullets:
<% p.metadata.bullets.each do |b| -%>
        - <%= b %>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
